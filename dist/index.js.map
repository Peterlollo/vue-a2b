{"version":3,"file":"index.js","sources":["../src/toolbox.js","../src/persistence.js","../src/index.js"],"sourcesContent":["// greatest common denominator\nfunction gcd (a, b) {\n  return b ? gcd(b, a % b) : a\n}\n\n// gcd for n elements\nfunction gcdOfList (ary) {\n  return ary.reduce((acc, v) => gcd(acc, v))\n}\n\n// create a list with test candidate that respects the selection chances\nfunction getCandidates (variations) {\n  const equalChance = Math.round(100.0 / variations.length)\n  let names = []\n  let chances = []\n\n  variations.forEach(v => {\n    if (v.data && v.data.slot) {\n      const chance = parseInt(v.data.attrs.chance) || equalChance\n      names.push(v.data.slot)\n      chances.push(chance)\n    }\n  })\n\n  const divisor = gcdOfList(chances)\n\n  return names.reduce((result, name, i) => {\n    const n = Math.round(chances[i] / divisor)\n    for (let i = 0; i < n; i++) result.push(name)\n    return result\n  }, [])\n}\n\n// return random element of array\nexport function pickRandomlyFrom (array) {\n  const index = Math.round(Math.random() * array.length)\n  return array[index]\n}\n\n// pick a random candidate respecting the selection chances\nexport function randomCandidate (variations) {\n  const candidates = getCandidates(variations)\n  return pickRandomlyFrom(candidates)\n}\n\nfunction daysToMicroSeconds (days) {\n  return days * 24 * 3600 * 1000\n}\n\nexport function getCookie (name) {\n  const entries = document.cookie.split(';')\n  const len = name.length\n\n  for (const i in entries) {\n    const entry = entries[i].trim()\n\n    if (entry.substr(0, len) === name) {\n      const value = decodeURIComponent( entry.slice(len + 1) )\n      return JSON.parse(value)\n    }\n  }\n}\n\nexport function writeCookie (name, data, expiry) {\n  const d = new Date()\n  d.setTime(d.getTime() + daysToMicroSeconds(expiry))\n\n  const options = `expires=${d.toUTCString()};path=/`\n  data = encodeURIComponent(JSON.stringify(data))\n  document.cookie = `${name}=${data};${options}`\n}\n\nexport function getLocalStorage (name, expiry) {\n  const d = new Date()\n  d.setTime(d.getTime() + daysToMicroSeconds(expiry))\n  const entry = JSON.parse(localStorage.getItem(name))\n\n  return entry && entry.expires > d.getTime() ? entry : null\n}\n\nexport function writeLocalStorage (name, value, expiry) {\n  value.expiry = new Date().getTime() + daysToMicroSeconds(expiry)\n  localStorage.setItem(name, JSON.stringify(value))\n}\n","import {\n  getCookie, writeCookie,\n  getLocalStorage, writeLocalStorage\n} from './toolbox'\n\nexport default {\n  _store: null,\n  name: 'split-test', // name of cookie or localStorage entry\n  method: 'cookie',   // supported methods are 'cookie' and 'localStorage'\n  expiry: 30,         // ignore entries that weren't touched this amount of days\n\n  _load () {\n    if (this.method === 'cookie')\n      this._store = getCookie(this.name) || {}\n    else if (this.method === 'localStorage')\n      this._store = getLocalStorage(this.name, this.expiry) || {}\n    else {\n      console.warn(\"VueA2B WARNING: No or invalid storage method. Data will not persist.\")\n      this._store = {}\n    }\n    return this._store\n  },\n\n  _save () {\n    if (this.method === 'cookie')\n      writeCookie(this.name, this._store, this.expiry)\n    else if (this.method === 'localStorage')\n      writeLocalStorage(this.name, this._store, this.expiry)\n  },\n\n  get entry () {\n    return this._store || this._load()\n  },\n\n  set entry ({name, winner}) {\n    this._store[name] = winner\n    this._save()\n  }\n}\n","import storage from './persistence'\nimport { randomCandidate } from './toolbox'\n\nconst VueSplitter = {\n  install (Vue, options = {}) {\n\n    if (options.storage) {\n      const cfg = options.storage\n      if (cfg.name) storage.name = cfg.name\n      if (cfg.method) storage.method = cfg.method\n      if (cfg.expiry) storage.expiry = parseInt(expiry)\n    }\n\n    Vue.component(options.component || 'split-test', {\n      functional: true,\n      props: {\n        always: String,\n        name: String\n      },\n      render (h, ctx) {\n        const name = ctx.props.name || ctx.parent.$options.name\n        if (!name) throw 'VueA2B Error: The test name is mandatory!'\n\n        const variations = ctx.slots()\n        const winner = storage.entry[name]\n          || ctx.props.always\n          || randomCandidate(ctx.children)\n\n        storage.entry = {name, winner}\n        return variations[winner]\n      }\n    })\n  }\n}\n\nexport default VueSplitter\n"],"names":["gcd","a","b","gcdOfList","ary","acc","v","getCandidates","variations","const","equalChance","names","chances","chance","divisor","result","name","i","n","let","pickRandomlyFrom","array","index","randomCandidate","candidates","daysToMicroSeconds","days","getCookie","entries","len","entry","value","writeCookie","data","expiry","d","options","getLocalStorage","writeLocalStorage","ref","winner","VueSplitter","Vue","cfg","storage","h","ctx"],"mappings":"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"}